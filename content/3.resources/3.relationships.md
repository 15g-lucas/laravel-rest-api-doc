# Relationships

In addition to the variety of fields we've already discussed, Laravel Rest Api has full support for all of Laravel's relationships. Once you add relationship to your Rest resources, you'll be able to access those relationships directly from the requested resource without the necessity to make multiple calls to the API.

Be aware that all relation must be made on resource even though they'll be linked to Laravel relationships. You can't link models without using a resource. This allows Laravel Rest Api to take full advantage of Rest Resources to make powerful and secure your requests.


Your relationships should all be declared in the "relations" method of your resource:
```php
class ModelResource extends Resource
{
    public function relations(RestRequest $request)
    {
        return [
            HasOne::make('hasOneRelation', HasOneResource::class),
            BelongsTo::make('belongsToRelation', BelongsToResource::class),
            HasMany::make('hasManyRelation', HasManyResource::class),
            BelongsToMany::make('belongsToManyRelation', BelongsToManyResource::class)
                ->withPivotFields(['created_at']),
        ];
    }
}
```

## Has One

The `HasOne` relation corresponds to a `hasOne` Eloquent relationship. For example, let's assume a User model hasOne Address model. We may add the relationship to our User Rest resource like so:

```php
use Lomkit\Rest\Relations\HasOne;

HasOne::make('address', AddressResource::class),
```

### Has One Of Many

::alert{type="info"}
:icon{name="bytesize:activity" size=25}&nbsp;
Not available for now.
::

## Has Many

The `HasMany` relation corresponds to a `hasMany` Eloquent relationship. For example, let's assume a User model hasMany Post models. We may add the relationship to our User Rest resource like so:
```php
use Lomkit\Rest\Relations\HasMany;

HasMany::make('posts', PostResource::class),
```

## Has One Through

The `HasOneThrough` relation corresponds to a `hasOneThrough` Eloquent relationship. For example, let's assume a User model hasOne car through a Company model. We may add the relationship to our User Rest resource like so:

```php
use Lomkit\Rest\Relations\HasOneThrough;

HasOneThrough::make('car', CarResource::class),
```

::alert{type="warning"}
:icon{name="ant-design:exclamation-circle-outlined" size=20}&nbsp;
You can't mutate models using "HasOneThrough" relationships, please use a double "HasOne" relationship if you want to mutate the distant entry
::

## Has Many Through

The `HasManyThrough` relation corresponds to a `hasManyThrough` Eloquent relationship. For example, let's assume a User model hasMany stars through a Company model. We may add the relationship to our User Rest resource like so:
```php
use Lomkit\Rest\Relations\HasManyThrough;

HasManyThrough::make('star', StarResource::class),
```

::alert{type="warning"}
:icon{name="ant-design:exclamation-circle-outlined" size=20}&nbsp;
You can't mutate models using "HasManyThrough" relationships, please use a "HasOne" followed by a "HasMany" relationship if you want to mutate the distant entry
::

## Belongs To

The `BelongsTo` relation corresponds to a `belongsTo` Eloquent relationship. For example, let's assume a User model belongsTo a Company model. We may add the relationship to our User Rest resource like so:
```php
use Lomkit\Rest\Relations\BelongsTo;

BelongsTo::make('company', CompanyResource::class),
```

## Belongs To Many

The `BelongsToMany` relation corresponds to a `belongsToMany` Eloquent relationship. For example, let's assume a User model belongsToMany Role models. We may add the relationship to our User Rest resource like so:
```php
use Lomkit\Rest\Relations\BelongsToMany;

BelongsToMany::make('roles', RoleResource::class),
```

###  Pivot fields

If you have pivot fields you want to specify you can achieve this using:
```php
use Lomkit\Rest\Relations\BelongsToMany;

BelongsToMany::make('roles', RoleResource::class)->withPivotFields(['created_at']),
```

::callout{type="warning"}
#summary
Don't forget to specify those pivot fields on your model relationship.

#content
```php
public function roles() {
    return $this->belongsToMany(Role::class)
        ->withPivot('created_at', 'updated_at');
}
```
::

## MorphOne

The `MorphOne` relation corresponds to a `morphOne` Eloquent relationship. For example, let's assume a User model MorphOne Address model. We may add the relationship to our User Rest resource like so:
```php
use Lomkit\Rest\Relations\MorphOne;

MorphOne::make('address', AddressResource::class),
```

### Morph One Of Many

The `MorphOneOfMany` relation corresponds to a `morphOneOfMany` Eloquent relationship. For example, let's assume a User model MorphOneOfMany color models. We may add the relationship to our User Rest resource like so:
```php
use Lomkit\Rest\Relations\MorphOneOfMany;

MorphOneOfMany::make('color', ColorResource::class),
```

## Morph Many

The `MorphMany` relation corresponds to a `morphMany` Eloquent relationship. For example, let's assume a User model MorphMany Color models. We may add the relationship to our User Rest resource like so:
```php
use Lomkit\Rest\Relations\MorphMany;

MorphMany::make('colors', ColorResource::class),
```

## Morph To

The `MorphTo` relation corresponds to a `morphTo` Eloquent relationship. For example, let's assume a Comment model MorphTo a Post or an Video model. We may add the relationship to our Comment Rest resource like so:
```php
use Lomkit\Rest\Relations\MorphTo;

MorphTo::make('commentable', [PostResource::class, VideoResource::class]),
```

For this relation we need to specify as a second argument all the possible morph resources.

## Morph To Many

::alert{type="info"}
:icon{name="bytesize:activity" size=25}&nbsp;
Not available for now.
::

## Required On Creation Relation

In some cases you want to force the presence of some relations on creation because the database constraint force the presence of the relation.

You can require a relation using:
```php
use Lomkit\Rest\Relations;

BelongsTo::make('company', CompanyResource::class)
    ->requiredOnCreation(),
```

You can also specify a closure to condition this:
```php
use Lomkit\Rest\Relations;

BelongsTo::make('company', CompanyResource::class)
    ->requiredOnCreation(function(\Lomkit\Rest\Http\Requests\RestRequest $request) {
        return true;
    }),
```
